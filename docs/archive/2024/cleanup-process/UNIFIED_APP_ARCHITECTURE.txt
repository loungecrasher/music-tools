================================================================================
                   MUSIC TOOLS SUITE - UNIFIED ARCHITECTURE
                          Integration Blueprint v1.0
================================================================================

┌──────────────────────────────────────────────────────────────────────────┐
│                         USER INTERFACE LAYER                              │
└──────────────────────────────────────────────────────────────────────────┘

                         unified_menu.py (Main Entry)
                                    │
                    ┌───────────────┼───────────────┐
                    ▼               ▼               ▼
          ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
          │  Streaming  │  │   Tagging   │  │  Discovery  │
          │    Menu     │  │    Menu     │  │    Menu     │
          └─────────────┘  └─────────────┘  └─────────────┘
                 │                 │                 │
                 └─────────────────┴─────────────────┘
                                   │
                          ┌────────┴────────┐
                          ▼                 ▼
                  ┌──────────────┐  ┌──────────────┐
                  │Configuration │  │ Help System  │
                  │   & Settings │  │ & Docs       │
                  └──────────────┘  └──────────────┘


┌──────────────────────────────────────────────────────────────────────────┐
│                       APPLICATION MODULES LAYER                           │
└──────────────────────────────────────────────────────────────────────────┘

┌──────────────────────┐  ┌──────────────────────┐  ┌──────────────────────┐
│  STREAMING MODULE    │  │   TAGGING MODULE     │  │  DISCOVERY MODULE    │
│  (Music Tools)       │  │  (Country Editor)    │  │  (EDM Scraper)       │
├──────────────────────┤  ├──────────────────────┤  ├──────────────────────┤
│                      │  │                      │  │                      │
│ • Spotify Manager    │  │ • AI Tagger          │  │ • Blog Scraper       │
│ • Deezer Repair      │  │ • Library Scanner    │  │ • Link Extractor     │
│ • Library Compare    │  │ • Batch Processor    │  │ • Quality Selector   │
│ • Date Filter        │  │ • Metadata Writer    │  │ • Genre Filter       │
│ • Duplicate Remover  │  │ • Cache Manager      │  │ • Async Scraper      │
│ • Soundiz Processor  │  │ • Statistics         │  │ • Output Manager     │
│                      │  │                      │  │                      │
└──────────┬───────────┘  └──────────┬───────────┘  └──────────┬───────────┘
           │                         │                          │
           └─────────────────────────┴──────────────────────────┘
                                     │
                                     ▼


┌──────────────────────────────────────────────────────────────────────────┐
│                      SHARED LIBRARY LAYER                                 │
│                   (music_tools_common)                                    │
└──────────────────────────────────────────────────────────────────────────┘

┌─────────────┬─────────────┬─────────────┬─────────────┬─────────────────┐
│   CONFIG    │  DATABASE   │     AUTH    │     CLI     │     UTILS       │
│   MANAGER   │   MANAGER   │   CLIENTS   │  FRAMEWORK  │   LIBRARY       │
├─────────────┼─────────────┼─────────────┼─────────────┼─────────────────┤
│             │             │             │             │                 │
│ • Load/Save │ • SQLite DB │ • Spotify   │ • Menus     │ • Retry Logic   │
│ • Validate  │ • Cache     │ • Deezer    │ • Progress  │ • Validation    │
│ • Env Vars  │ • Models    │ • Anthropic │ • Prompts   │ • File Ops      │
│ • Security  │ • Migration │ • OAuth2    │ • Rich UI   │ • HTTP Client   │
│ • Schemas   │ • Backup    │ • Tokens    │ • Tables    │ • Security      │
│             │             │             │             │                 │
└─────────────┴─────────────┴─────────────┴─────────────┴─────────────────┘
           │                         │                          │
           └─────────────────────────┴──────────────────────────┘
                                     │
                                     ▼


┌──────────────────────────────────────────────────────────────────────────┐
│                      DATA PERSISTENCE LAYER                               │
└──────────────────────────────────────────────────────────────────────────┘

                    ~/.music_tools/ (User Data Directory)
                                    │
         ┌──────────────────────────┼──────────────────────────┐
         ▼                          ▼                          ▼
    ┌─────────┐              ┌──────────────┐           ┌──────────┐
    │ config/ │              │    data/     │           │  cache/  │
    ├─────────┤              ├──────────────┤           ├──────────┤
    │         │              │              │           │          │
    │ spotify │              │ music_tools  │           │ api      │
    │ deezer  │              │     .db      │           │ artist   │
    │ anthropic│             │              │           │ metadata │
    │ scraper │              │   [UNIFIED   │           │          │
    │ app     │              │   DATABASE]  │           │          │
    │         │              │              │           │          │
    └─────────┘              └──────────────┘           └──────────┘
         │                          │                          │
         └──────────────────────────┴──────────────────────────┘
                                    │
                                    ▼
                              ┌──────────┐
                              │  logs/   │
                              ├──────────┤
                              │          │
                              │ unified  │
                              │ streaming│
                              │ tagging  │
                              │ scraper  │
                              │          │
                              └──────────┘


┌──────────────────────────────────────────────────────────────────────────┐
│                    EXTERNAL SERVICES LAYER                                │
└──────────────────────────────────────────────────────────────────────────┘

┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│   Spotify    │  │    Deezer    │  │  Anthropic   │  │  Blog Sites  │
│     API      │  │     API      │  │   API        │  │  (Public)    │
├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤
│              │  │              │  │              │  │              │
│ OAuth2       │  │ Cookie Auth  │  │ API Key      │  │ HTTP/HTTPS   │
│ Rate Limited │  │ Rate Limited │  │ Rate Limited │  │ Rate Limited │
│              │  │              │  │              │  │              │
└──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘


================================================================================
                         DATABASE SCHEMA (UNIFIED)
================================================================================

┌─────────────────────────────────────────────────────────────────────────┐
│                      music_tools.db (SQLite)                            │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  MUSIC STREAMING DATA (Music Tools)                                    │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                         │
│  playlists                    tracks                playlist_tracks    │
│  ┌──────────────┐            ┌──────────────┐      ┌──────────────┐   │
│  │ id (PK)      │            │ id (PK)      │      │ playlist_id  │   │
│  │ name         │            │ name         │      │ track_id     │   │
│  │ url          │            │ artist       │      │ added_at     │   │
│  │ owner        │            │ album        │      │ position     │   │
│  │ tracks_count │            │ duration     │      └──────────────┘   │
│  │ service      │◄───────────│ service      │              ▲          │
│  │ is_algorithmic│           │ release_date │              │          │
│  │ added_on     │            │ isrc         │              │          │
│  │ last_updated │            │ added_on     │              │          │
│  └──────────────┘            │ last_updated │              │          │
│         │                    └──────────────┘              │          │
│         └─────────────────────────────────────────────────┘          │
│                                                                         │
│  METADATA CACHE (Tag Country Editor)                                   │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                         │
│  artist_country_cache                                                   │
│  ┌──────────────────┐                                                  │
│  │ artist_name (PK) │                                                  │
│  │ country          │                                                  │
│  │ confidence       │                                                  │
│  │ source           │  (api/claude_code)                               │
│  │ cached_at        │                                                  │
│  │ expires_at       │                                                  │
│  └──────────────────┘                                                  │
│                                                                         │
│  BLOG SCRAPING DATA (EDM Scraper - NEW)                                │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                         │
│  blog_posts                   download_links                           │
│  ┌──────────────┐            ┌──────────────────┐                     │
│  │ id (PK)      │            │ id (PK)          │                     │
│  │ url          │◄───────────│ blog_post_id (FK)│                     │
│  │ title        │            │ url              │                     │
│  │ genres       │ (JSON)     │ format           │ (flac/mp3_320)      │
│  │ post_date    │            │ quality_score    │                     │
│  │ scraped_at   │            │ extracted_at     │                     │
│  └──────────────┘            └──────────────────┘                     │
│                                                                         │
│  SHARED TABLES (All Tools)                                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│                                                                         │
│  settings                     processing_log                           │
│  ┌──────────────┐            ┌──────────────┐                         │
│  │ key (PK)     │            │ id (PK)      │                         │
│  │ value        │ (JSON)     │ tool         │ (streaming/tagging/scraper)│
│  │ updated_at   │            │ operation    │                         │
│  └──────────────┘            │ status       │                         │
│                              │ details      │                         │
│                              │ timestamp    │                         │
│                              └──────────────┘                         │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘


================================================================================
                           DATA FLOW DIAGRAMS
================================================================================

EXAMPLE 1: Discover → Tag → Playlist Workflow
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

    ┌─────────────┐
    │ User Input  │
    │ "Find new   │
    │  house      │
    │  music"     │
    └──────┬──────┘
           │
           ▼
    ┌─────────────────┐
    │  EDM Scraper    │ ──► Scan blogs for "house" genre
    │  Module         │     Extract FLAC download links
    └────────┬────────┘     Save to blog_posts table
             │
             ▼
    ┌─────────────────┐
    │   Database      │ ──► Store: blog URL, genres, links
    │   blog_posts    │     Quality score: FLAC = 10
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ User Downloads  │ ──► User downloads FLAC files
    │ Files Locally   │     Stores in ~/Music/New/
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Country Tagger  │ ──► Scan ~/Music/New/
    │ Module          │     AI analyzes: Artist → Country
    └────────┬────────┘     Write to GROUPING tag
             │
             ▼
    ┌─────────────────┐
    │   Database      │ ──► Cache: Artist → Country
    │ artist_country  │     Reuse for future files
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Spotify Manager │ ──► Create playlist "New House"
    │ Module          │     Add tracks via search
    └────────┬────────┘     Store in database
             │
             ▼
    ┌─────────────────┐
    │   Database      │ ──► Store: playlist, tracks
    │  playlists +    │     Link: playlist_tracks
    │   tracks        │
    └─────────────────┘


EXAMPLE 2: Cross-Tool Artist Data Sharing
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

    ┌─────────────────┐
    │ Spotify Sync    │ ──► Fetch playlist tracks
    │ (Music Tools)   │     Extract artist names
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │   Database      │ ──► Store tracks with artists
    │     tracks      │     Query: artists needing tags
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ Country Tagger  │ ──► Check cache for artist
    │ (Auto-trigger)  │     If missing: AI lookup
    └────────┬────────┘     Store country in cache
             │
             ▼
    ┌─────────────────┐
    │   Database      │ ──► Update artist_country_cache
    │ artist_country  │     Available for all tools
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │  EDM Scraper    │ ──► Filter blog posts by country
    │ (Enhanced)      │     Prefer local artists
    └─────────────────┘     Use cached data


================================================================================
                         CONFIGURATION STRUCTURE
================================================================================

~/.music_tools/config/
│
├── spotify_config.json
│   {
│     "redirect_uri": "http://localhost:8888/callback"
│     # client_id/secret in ENV only
│   }
│
├── deezer_config.json
│   {
│     "email": "user@example.com"
│     # No sensitive data
│   }
│
├── anthropic_config.json
│   {
│     "model": "claude-4-sonnet-20250522",
│     "timeout": 30,
│     "max_retries": 3
│     # api_key in ENV only
│   }
│
├── edm_scraper_config.json
│   {
│     "preferred_genres": ["house", "progressive house", ...],
│     "max_pages": 10,
│     "quality_preference": "flac_first"
│   }
│
└── unified_app_config.json
    {
      "theme": "dark",
      "show_tooltips": true,
      "auto_backup": true,
      "log_level": "INFO"
    }


Environment Variables (.env):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
SPOTIPY_CLIENT_ID=xxx
SPOTIPY_CLIENT_SECRET=xxx
SPOTIPY_REDIRECT_URI=http://localhost:8888/callback

DEEZER_EMAIL=user@example.com

ANTHROPIC_API_KEY=xxx
MUSIC_TAGGER_MODEL=claude-4-sonnet-20250522

MUSIC_TOOLS_CONFIG_DIR=~/.music_tools
MUSIC_TOOLS_DATA_DIR=~/.music_tools/data


================================================================================
                           MODULE INTERACTION
================================================================================

┌─────────────────────────────────────────────────────────────────────────┐
│                    MODULE COMMUNICATION MATRIX                          │
├─────────────┬───────────────┬───────────────┬─────────────────────────┤
│             │   Streaming   │    Tagging    │      Discovery          │
├─────────────┼───────────────┼───────────────┼─────────────────────────┤
│ Streaming   │      -        │  Artist data  │  Track recommendations  │
│             │               │  → tagging    │  ← discovery            │
├─────────────┼───────────────┼───────────────┼─────────────────────────┤
│ Tagging     │  Artist info  │       -       │  Genre classification   │
│             │  ← streaming  │               │  → discovery            │
├─────────────┼───────────────┼───────────────┼─────────────────────────┤
│ Discovery   │  Playlist     │  Genre data   │          -              │
│             │  suggestions  │  ← tagging    │                         │
│             │  → streaming  │               │                         │
└─────────────┴───────────────┴───────────────┴─────────────────────────┘

Shared via:
• Unified Database (music_tools.db)
• Common cache (artist_country_cache)
• Settings table (preferences)
• Processing logs (audit trail)


================================================================================
                        DEPLOYMENT ARCHITECTURE
================================================================================

Development Environment:
━━━━━━━━━━━━━━━━━━━━━━━━
~/Music Tools Dev/
├── music_tools_common/        # Shared library (editable install)
├── Music Tools/               # Module 1
├── Tag Country Origin Editor/ # Module 2
├── EDM Sharing Site Web Scrapper/ # Module 3
└── unified_app/               # New unified entry point
    ├── unified_menu.py
    ├── modules/
    │   ├── streaming.py
    │   ├── tagging.py
    │   └── discovery.py
    └── setup.py

User Environment:
━━━━━━━━━━━━━━━━━
~/.music_tools/
├── config/           # User configurations
├── data/             # SQLite database
├── cache/            # Performance cache
└── logs/             # Application logs

/usr/local/bin/       # OR ~/bin/
└── music-tools       # Executable entry point


Production Install:
━━━━━━━━━━━━━━━━━━━
$ pip install music-tools-suite
$ music-tools         # Launch unified app


================================================================================
                        PERFORMANCE CHARACTERISTICS
================================================================================

Database Operations:
━━━━━━━━━━━━━━━━━━━
• Single connection pool (shared across modules)
• WAL mode enabled (concurrent reads + 1 write)
• Prepared statements (cached queries)
• Bulk inserts (1000 records in ~100ms)
• Index optimization (artist, service, date columns)

Benchmarks:
━━━━━━━━━━
Operation               | Time      | Notes
─────────────────────────────────────────────────
App startup             | 200-500ms | Load config + connect DB
Playlist sync (100)     | 2-5s      | API rate limited
Tag 50 files            | 30-60s    | AI API calls (batch)
Scrape 10 pages         | 15-30s    | Network + parsing
Switch between modules  | <50ms     | In-memory transition
Database query (simple) | 0.5-2ms   | Single record lookup
Database query (complex)| 5-20ms    | Joins + filters
Cache hit               | <1ms      | In-memory lookup

Memory Usage:
━━━━━━━━━━━━
• Base application: 50-80 MB
• Per module loaded: +10-20 MB
• Database connection: +5-10 MB
• Rich UI rendering: +15-25 MB
• Total (all modules): ~100-150 MB


================================================================================
                         SECURITY ARCHITECTURE
================================================================================

Credential Storage:
━━━━━━━━━━━━━━━━━━━
┌──────────────────┐
│  Environment     │  ← Highest priority
│  Variables       │    (NEVER in files)
│  (.env)          │
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Config Files    │  ← Non-sensitive only
│  (JSON)          │    (redirect URIs, models)
└────────┬─────────┘
         │
         ▼
┌──────────────────┐
│  Default Values  │  ← Lowest priority
│  (Code)          │    (fallbacks only)
└──────────────────┘

File Permissions:
━━━━━━━━━━━━━━━━━
~/.music_tools/          0700 (drwx------)
~/.music_tools/config/   0700 (drwx------)
*.json configs           0600 (-rw-------)
.env file                0600 (-rw-------)
music_tools.db           0600 (-rw-------)

Data Protection:
━━━━━━━━━━━━━━━━
• API tokens: Environment variables only
• Passwords: Never stored
• OAuth tokens: OS keychain (future)
• Database: File-level encryption (future)
• Network: HTTPS only for API calls
• Logs: Sanitized (no credentials)


================================================================================
                         BACKUP & RECOVERY
================================================================================

Automated Backups:
━━━━━━━━━━━━━━━━━━
~/.music_tools/backups/
├── music_tools.db.backup.20251115_1430
├── music_tools.db.backup.20251114_1430
└── music_tools.db.backup.20251113_1430

Backup Schedule:
• Before major operations (migrations, imports)
• Daily automatic (configurable)
• Manual on-demand (via menu)
• Rotation: Keep last 7 days

Recovery:
━━━━━━━━
1. Detect corruption (SQLite integrity check)
2. Prompt user to select backup
3. Restore from backup
4. Verify data integrity
5. Resume operations


================================================================================
                            EXTENSIBILITY
================================================================================

Plugin Architecture (Future):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

~/.music_tools/plugins/
├── youtube_downloader/
│   ├── plugin.json      # Metadata
│   ├── __init__.py      # Entry point
│   └── menu.py          # UI integration
│
└── music_analysis/
    ├── plugin.json
    ├── analyzer.py
    └── visualizations.py

Plugin API:
• Access to shared database
• Use common UI framework
• Register menu items
• Event system integration
• Sandboxed execution


================================================================================
                        MONITORING & LOGGING
================================================================================

Log Structure:
━━━━━━━━━━━━━━
~/.music_tools/logs/
├── unified.log          # Main application
├── streaming.log        # Music Tools module
├── tagging.log          # Country Editor module
├── discovery.log        # EDM Scraper module
└── errors.log           # Errors only (all modules)

Log Format:
2025-11-15 14:30:25 [INFO] [streaming] Syncing Spotify playlist "House Vibes"
2025-11-15 14:30:26 [DEBUG] [database] Query: SELECT * FROM playlists WHERE service='spotify'
2025-11-15 14:30:27 [ERROR] [tagging] API timeout after 30s: claude-4-sonnet-20250522

Monitoring:
• Operation counters (processed files, API calls)
• Performance metrics (timing, memory)
• Error tracking (by module, type)
• Health checks (database, API availability)


================================================================================
                             END OF ARCHITECTURE
================================================================================

Document Version: 1.0
Created: 2025-11-15
Status: Design Approved
Implementation: Pending
